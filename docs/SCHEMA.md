# Arc/Chrome History Database Schema

The history database is a SQLite database that contains browsing history. The main tables used in this project are:

## Table: urls

| Column Name     | Type        | Constraints        | Description          |
| --------------- | ----------- | ------------------ | -------------------- |
| id              | INTEGER     | PRIMARY KEY        | Unique identifier    |
| url             | LONGVARCHAR |                    | The complete URL     |
| title           | LONGVARCHAR |                    | Page title           |
| visit_count     | INTEGER     | DEFAULT 0 NOT NULL | Number of visits     |
| typed_count     | INTEGER     | DEFAULT 0 NOT NULL | Times URL was typed  |
| last_visit_time | INTEGER     | NOT NULL           | Last visit timestamp |
| hidden          | INTEGER     | DEFAULT 0 NOT NULL | Hidden from history  |
| favicon_id      | INTEGER     | DEFAULT 0 NOT NULL | Icon identifier      |

## Table: visits

| Column Name                     | Type    | Constraints            | Description            |
| ------------------------------- | ------- | ---------------------- | ---------------------- |
| id                              | INTEGER | PRIMARY KEY            | Unique identifier      |
| url                             | INTEGER | NOT NULL               | Foreign key to urls.id |
| visit_time                      | INTEGER | NOT NULL               | Visit timestamp        |
| from_visit                      | INTEGER |                        | Previous visit ID      |
| transition                      | INTEGER | DEFAULT 0 NOT NULL     | Navigation type        |
| segment_id                      | INTEGER |                        | Session group ID       |
| visit_duration                  | INTEGER | DEFAULT 0 NOT NULL     | Time spent on page     |
| incremented_omnibox_typed_score | BOOLEAN | DEFAULT FALSE NOT NULL | Omnibox score updated  |

## Note on Timestamps

Chrome/Arc stores timestamps as microseconds since January 1, 1601 UTC. To convert to Unix timestamp:

1. Divide by 1,000,000 to convert to seconds
2. Subtract 11,644,473,600 (seconds between 1601 and 1970)

## Common transition types

| Value | Type            | Description                        |
| ----- | --------------- | ---------------------------------- |
| 0     | LINK            | User clicked a link                |
| 1     | TYPED           | User typed URL                     |
| 2     | AUTO_BOOKMARK   | User used a bookmark               |
| 3     | AUTO_SUBFRAME   | Automatically loaded in a subframe |
| 4     | MANUAL_SUBFRAME | Manually loaded in a subframe      |
| 5     | GENERATED       | Generated by the page              |
| 6     | START_PAGE      | Start page                         |
| 7     | FORM_SUBMIT     | Form submission                    |
| 8     | RELOAD          | Page reload                        |
| 9     | KEYWORD         | Keyword search                     |

## Complete Schema

### downloads

| Column Name        | Type    | Description              |
| ------------------ | ------- | ------------------------ |
| id                 | INTEGER | Primary key              |
| guid               | TEXT    | Unique identifier        |
| current_path       | TEXT    | Download location        |
| target_path        | TEXT    | Original target path     |
| start_time         | INTEGER | Download start time      |
| received_bytes     | INTEGER | Bytes received           |
| total_bytes        | INTEGER | Total file size          |
| state              | INTEGER | Download state           |
| danger_type        | INTEGER | Security status          |
| interrupt_reason   | INTEGER | Why download stopped     |
| hash               | BLOB    | File hash                |
| end_time           | INTEGER | Download completion time |
| opened             | INTEGER | If file was opened       |
| last_access_time   | INTEGER | Last access time         |
| transient          | INTEGER | If download is temporary |
| referrer           | TEXT    | Download source URL      |
| site_url           | TEXT    | Site URL                 |
| tab_url            | TEXT    | Tab URL                  |
| tab_referrer_url   | TEXT    | Tab referrer             |
| http_method        | TEXT    | HTTP method used         |
| by_ext_id          | TEXT    | Extension ID if any      |
| by_ext_name        | TEXT    | Extension name           |
| etag               | TEXT    | HTTP ETag                |
| last_modified      | TEXT    | Last-Modified header     |
| mime_type          | TEXT    | File MIME type           |
| original_mime_type | TEXT    | Original MIME type       |

### downloads_url_chains

| Column Name | Type    | Description           |
| ----------- | ------- | --------------------- |
| id          | INTEGER | Download ID           |
| chain_index | INTEGER | URL position in chain |
| url         | TEXT    | URL in redirect chain |

### keyword_search_terms

| Column Name | Type    | Constraints | Description           |
| ----------- | ------- | ----------- | --------------------- |
| keyword_id  | INTEGER | NOT NULL    | Search provider ID    |
| url_id      | INTEGER | NOT NULL    | Related URL ID        |
| lower_term  | TEXT    | NOT NULL    | Lowercase search term |
| term        | TEXT    | NOT NULL    | Original search term  |

### meta

| Column Name | Type        | Constraints                 | Description   |
| ----------- | ----------- | --------------------------- | ------------- |
| key         | LONGVARCHAR | NOT NULL UNIQUE PRIMARY KEY | Setting key   |
| value       | LONGVARCHAR |                             | Setting value |

### segments

| Column Name | Type    | Constraints         | Description        |
| ----------- | ------- | ------------------- | ------------------ |
| id          | INTEGER | PRIMARY KEY         | Unique identifier  |
| name        | TEXT    |                     | Segment name       |
| url_id      | INTEGER | NOT NULL            | Starting URL       |
| pres_index  | INTEGER | DEFAULT -1 NOT NULL | Presentation index |
